<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Echo Tape</title>
    <meta name="description" content="Experimental interactive story told in the browser. Guide the characters through episodic adventures and uncover the mystery.">
    <meta property="og:title" content="The Echo Tape">
    <meta property="og:description" content="Experimental interactive story told in the browser. Choose your own path and uncover the mystery.">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="title-screen" class="screen visible">
         <h1 class="glitch-title">ðŸŒ€ THE ECHO TAPE ðŸŒ€</h1>
         <p style="font-size: 1.2em; color: #ccc;">An Interactive Experience</p>
         <button id="start-btn" class="menu-btn" aria-label="Start the game">INSERT TAPE</button>
        <button id="continue-btn" class="menu-btn" style="display:none" aria-label="Continue game">CONTINUE</button>
        <button id="dev-btn" class="menu-btn" aria-label="Open dev tools">DEV TOOLS</button>
    </div>

    <div id="dev-screen" class="screen">
         <h1 class="glitch-title">DEV TOOLS</h1>
        <button id="clear-save-btn" class="menu-btn" aria-label="Clear saved progress">Clear Saves</button>
        <button id="close-dev-btn" class="menu-btn" aria-label="Return to title">Back</button>
    </div>

    <div id="episode-screen" class="screen">
         <h1 class="glitch-title">SELECT EPISODE</h1>
        <button class="episode-btn" data-episode="0" aria-label="Play Tutorial">Tutorial: Rocket League Warmup</button>
         <button class="episode-btn" data-episode="1" aria-label="Play Episode 1">Episode 1: The Tape & The Lane</button>
        <button class="episode-btn" disabled aria-label="Episode 2 coming soon">Episode 2 - Coming Soon</button>
        <button id="return-title-btn" class="menu-btn" aria-label="Return to title">Back to Title</button>
    </div>

    <div id="intro-screen" class="screen">
         <div class="intro-text vhs-flicker">
             <p><em>Somewhere between memory and playback,<br> the story loops.</em></p>
             <p>Liverpool. The present, maybe.<br> A dead-end job, a lost tape, a street that doesnâ€™t exist.<br> Two friends haunted by the feeling that someone, or something, is watching.</p>
             <p>Thereâ€™s a VHS marked only by a warning:<br><span style="color:#ff00ff">DO NOT WATCH ALONE.</span></p>
             <p>The cats know something. Granny mumbles through static.<br> Reality glitches. Time doubles back. The door hums just out of sight.</p>
             <p>The tape waits to be played. Again. And again.<br><em>Maybe this time, you'll break the loop.<br>Or maybe youâ€™re already inside it.</em></p>
             <p><span style="color:#ff00ff">Insert the tape.<br> Begin the loop.</span></p>
         </div>
         <h1 id="intro-title" class="intro-title">ðŸŒ€ THE ECHO TAPE ðŸŒ€</h1>
         <button id="skip-intro-btn" class="menu-btn" aria-label="Skip intro">Skip Intro</button>
    </div>

    <div class="static-overlay"></div>
    <div class="record-light"></div>
    
    <div class="container" role="main">
        <h1 class="glitch-title">ðŸŒ€ THE ECHO TAPE ðŸŒ€</h1>
        <div class="nav-controls">
            <button id="back-btn" class="choice-btn" disabled aria-label="Go back">&larr; Back</button>
            <button id="history-btn" class="choice-btn" aria-label="View history">History</button>
        </div>
        <div class="audio-controls">
            <button id="mute-music-btn" class="choice-btn" aria-label="Toggle static audio">Mute Music</button>
            <label for="music-volume" class="visually-hidden">Music Volume</label>
            <input type="range" id="music-volume" min="0" max="1" step="0.01" value="1" aria-label="Music volume">
            <button id="mute-sfx-btn" class="choice-btn" aria-label="Toggle click sound">Mute SFX</button>
            <label for="sfx-volume" class="visually-hidden">SFX Volume</label>
            <input type="range" id="sfx-volume" min="0" max="1" step="0.01" value="1" aria-label="SFX volume">
        </div>
        <div id="vhs-screen" class="vhs-screen"></div>
        <div id="scene-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
        
    </div>

    <div id="history-overlay">
        <div>
            <h2 style="text-align:center;">Scene History</h2>
            <pre id="history-list"></pre>
            <div style="text-align:center; margin-top:10px;">
                <button id="close-history-btn" class="choice-btn" aria-label="Close history overlay">Close</button>
            </div>
        </div>
    </div>

    <audio id="title-music" src="audio/titleMusic.ogg" preload="auto" loop></audio>
    <audio id="title-music2" src="audio/titleMusic2.ogg" preload="auto" loop></audio>
    <audio id="sfx-click" src="audio/click.ogg" preload="auto"></audio>
    <audio id="sfx-static" src="audio/static.ogg" preload="auto" loop></audio>
    <audio id="tape-fx" src="audio/tape_fx.ogg" preload="auto"></audio>

    <!-- Episode data will be loaded dynamically -->
    <script type="importmap">
        {
            "imports": {
                "dompurify": "./src/dompurify.mjs"
            }
        }
    </script>
    <script src="dist/episodes/episode0.js"></script>
    <script src="dist/episodes/episode1.js"></script>
    <script type="module" src="src/script.mjs"></script>
    <script>
        if (window.location.protocol !== 'file:' && 'serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('dist/sw.js').catch(console.error);
            });
        }
    </script>
</body>
</html>
